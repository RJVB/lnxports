# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           cmake 1.1
PortGroup           boost 1.0
#PortGroup           conflicts_build 1.0
PortGroup           LTO 1.0
PortGroup           locale_select 1.0

name                gizmod
version             3.5 ; revision 1
license             Apache-2
categories          sysutils x11
platforms           linux
maintainers         openmaintainer
description         Gizmo Daemon
long_description    Gizmod is a utility for enabling alternative input devices to be used in Linux. \
                    This includes such devices as the PowerMate USB dial, fancy keyboards and mice with \
                    buttons not recognised or supported by X. Gizmod allows per application event mappings.
homepage            http://${name}.sourceforge.net
master_sites        https://downloads.sourceforge.net/project/${name}/${name}/${version}

use_bzip2           yes

checksums           rmd160  90bf061e759713cf24629016443fba09eb00131d \
                    sha256  63c7620e14a43719be0302f44597ca6c38f263de1672b9bb58da63db48d6ecef
#                     size    115721

#conflicts_build     boost

depends_lib-append  port:python310 \
                    port:alsa-lib \
                    port:xorg-libX11 \
                    port:xorg-libXext \
                    port:xorg-libice \
                    port:xorg-libsm

post-extract {
    file rename     ${worksrcpath}/cmake/Modules/FindBoost.cmake \
                    ${worksrcpath}/cmake/Modules/FindBoost.obsolete
}

patchfiles          patch-cmakefiles.diff \
                    patch-missing-cstddef.diff \
                    patch-boost-filesystem.diff

# this is a combination of
# `2to3-3.10 -w -n -f all -f buffer -f idioms -f set_literal -f ws_comma scripts`
# and manual fixes to the indentation
patchfiles-append   patch-py2to3.diff

post-patch {
    reinplace -W ${worksrcpath} "s|BOOST_|Boost_|g" \
                    visplugin/CMakeLists.txt \
                    gizmod/CMakeLists.txt \
                    libGizmod/CMakeLists.txt \
                    libH/CMakeLists.txt
    reinplace -W ${worksrcpath} "s|PythonLibs REQUIRED|PythonLibs 3.10 REQUIRED|g" \
                    visplugin/CMakeLists.txt \
                    gizmod/CMakeLists.txt \
                    libGizmod/CMakeLists.txt
}

configure.env       "BOOST_ROOT=[boost::install_area]"
compiler.cxx_standard 1998

cmake.install_rpath-append \
                    [boost::lib_dir]

configure.args-append \
                    -DPYTHON_EXECUTABLE=${prefix}/bin/python27

build.post_args-append -wk

post-destroot {
    xinstall -m 755 -d ${destroot}${prefix}/share/doc/${name}
    xinstall -W ${worksrcpath} -m 644 \
        COPYING INSTALL NOTICE README \
        ${destroot}${prefix}/share/doc/${name}/
}

